{% extends "base.html" %}
{% block content %}
<div class="card">
  <p><strong>E-mail:</strong> {{ email }} &middot; <strong>Papel:</strong> {{ papel }}</p>
  <div style="margin:0.5rem 0 1rem;"><strong>Feedback:</strong> {{ item["Feedback"] }}</div>

  <form method="post" action="/submit" id="form-avaliar">
    <input type="hidden" name="email" value="{{ email }}" />
    <input type="hidden" name="id" value="{{ item.id }}" />
    <input type="hidden" name="papel" value="{{ papel }}" />
    <!-- ajuda o backend a identificar que o form foi enviado mesmo sem problemas marcados -->
    <input type="hidden" name="problemas_submitted" value="1" />

    <label>Para você esse Feedback é bom e faz sentido?</label>
    <div>
      <label><input type="radio" name="resposta" value="Sim" required checked /> Sim</label>
      <label style="margin-left:1rem;"><input type="radio" name="resposta" value="Não" /> Não</label>
    </div>

    <!-- SEMPRE VISÍVEL -->
    <div id="problemasBox" style="margin-top:0.75rem;">
      <label>Se quiser, marque pontos de melhoria (opcional — mesmo se você marcou “Sim”):</label>
      <select name="problemas" multiple size="4" style="width:100%; max-width:480px;">
        {% for op in opcoes %}
          <option value="{{ op }}">{{ op }}</option>
        {% endfor %}
      </select>
      <p class="muted">Dica: use Ctrl/Cmd para selecionar várias opções.</p>
    </div>

    <div class="space"></div>
    <button class="btn btn-primary" type="submit">Confirmar e ir para o próximo ▶</button>
    <a class="btn btn-ghost" href="/?email={{ email }}">Ver lista</a>
  </form>
</div>

<script>
  // Atalhos de teclado: S = “Sim”, N = “Não”, Enter = enviar
  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 's') {
      const sim = document.querySelector('input[name="resposta"][value="Sim"]');
      if (sim) sim.checked = true;
    } else if (e.key.toLowerCase() === 'n') {
      const nao = document.querySelector('input[name="resposta"][value="Não"]');
      if (nao) nao.checked = true;
    } else if (e.key === 'Enter') {
      e.preventDefault(); // evita submeter em campos de seleção acidentalmente
      const form = document.getElementById('form-avaliar');
      if (form) form.submit();
    }
  });
</script>
{% endblock %}